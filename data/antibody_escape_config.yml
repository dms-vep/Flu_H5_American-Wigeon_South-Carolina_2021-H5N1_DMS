# Configurations for determining effects of mutations on assays such as antibody
# escape, receptor affinity from soluble receptor neutralization, etc.
# Note that in the configuration for individual selections, "antibody" is used
# as a synonym for any treatment (receptor, heat, etc), and "no-antibody" is
# used as a synonym for the untreated conditions.

# --------------------------------------------------------------------------------------
# Define the selections
# --------------------------------------------------------------------------------------

# `assays` is keyed by assay (eg, "antibody_escape", "receptor_affinity", etc). Values are:
#    - `title`: title given to selection in docs
#    - `selections`: name of key used to define all selections for this assay
#    - `averages`: name of key used to define averages across selections for this assay.
#       Leave out this key if not taking averages.
#    - `prob_escape_scale`: the scale used for the y-axis when plotting prob escape as
#      a function of concentration. Typically symlog if all values close to zero, linear
#      otherwise. Should be in the form of keyword arguments to `altair.Scale`.
#    - `scale_stat`: scale the statistic being estimated for mutation effects by this
#      number. Typically is 1 (no scaling) unless you want negative values to indicate a
#      favorable effect (as for soluble receptor selections), in which case use -1.
#    - `stat_name`: name assigned to statistic, eg, "escape" or "receptor affinity".

assays:
  antibody_escape:
    title: Antibody/serum escape
    selections: antibody_selections
    averages: avg_antibody_escape
    prob_escape_scale:
      type: symlog
      constant: 0.04
    scale_stat: 1
    stat_name: escape
  stability:
    title: stability
    selections: stability_selections
    averages: avg_stability
    prob_escape_scale:
      type: linear
    scale_stat: 1
    stat_name: stability

# --------------------------------------------------------------------------------------
# Configuration for the selection experiments for each assay
# --------------------------------------------------------------------------------------

# `<assay>_selections` is keyed by name of each selection experiment, which includes a
# no-antibody control samples and one or more antibody samples. These should typically
# be from the same library and run on same date. Selection experiments are recommended
# to be named as <Library>-<date as YYMMDD>-<description (eg, antibody)>-<replicate>.
# Each selection experiment should in turn provide the following keys:
#  - `neut_standard_name`: name of neutralization standard in `neut_standard_barcodes`
#  - `no_antibody_sample`: name of the no-antibody sample
#  - `antibody_samples`: a dict keyed by sample name with values of:
#    * `concentration`: the concentration of the antibody
#    * `use_in_fit`: whether to use this sample in the `polyclonal` fit
#  - `prob_escape_filters`: dict giving filters of prob_escape values to use for fitting
#  - `polyclonal_params`: dict giving parameters for `polyclonal` model fitting.
#  - `escape_plot_kwargs`: dict giving parameters for `polyclonal` escape plot
#  - `plot_hide_stats`: dict giving data frames with stats for slider to hide mutations
# The `use_in_fit` option exists because you may decide that some samples are outside
# the preferred neutralization range to include in the fit, so if `use_in_fit: false`
# then functional scores are computed and plotted but it is not included in the fit.

# default prob_escape filters
prob_escape_filters_default: &prob_escape_filters_default
  # error if sample used in fit doesn't have >= this many neut standard counts and
  # >= this fraction of all counts from neut standard.
  min_neut_standard_count: 1000
  min_neut_standard_frac: 0.0001
  # Only retain for fitting variants with at least this many counts and this fraction
  # of total counts in the no-antibody sample **OR** the indicated counts and fraction
  # of total counts in the antibody sample.
  min_no_antibody_count: 20  # make bigger for real experiments, say 20
  min_no_antibody_frac: 0.0000025  # make smaller for large libraries, say ~0.1 / (library size)
  min_antibody_count: 100  # make bigger for real experiments, say 100
  min_antibody_frac: 0.0001  # make smaller for large libraries, say ~10 / (library size)
  # For averaging and plotting the mean probability (fraction) escape across variants, use
  # these cutoffs:
  max_aa_subs: 3  # group variants with >= this many substitutions
  clip_uncensored_prob_escape: 5  # clip uncensored prob escape values at this max

# default parameters for `polyclonal` model fitting
polyclonal_params_default: &polyclonal_params_default
  n_epitopes: 1  # fit this many epitopes, also fit all numbers less than this and plot
  spatial_distances: null  # CSV with residue distances for spatial regularization, or null
  fit_kwargs:  # keyword arguments to `Polyclonal.fit`
    reg_escape_weight: 0.1
    reg_spread_weight: 0.25
    reg_activity_weight: 1.0
    logfreq: 200

# keyword arguments to `Polyclonal.mut_escape_plot`
escape_plot_kwargs_default: &escape_plot_kwargs_default
  alphabet: [A, C, D, E, F, G, H, I, K, L, M, N, P, Q, R, S, T, V, W, Y]
  addtl_slider_stats:
    times_seen: 2
  heatmap_max_at_least: 2
  heatmap_min_at_least: -2
  init_floor_at_zero: true
  init_site_statistic: sum
  site_zoom_bar_color_col: region  # supplied in `site_numbering_map`

# Specify any statistics (usually functional effects) for which you want to enable
# sliders that hide data. Keyed by statistic name, then next dict gives:
#   - `csv`: CSV file with the data, should have columns "site" and "mutant"
#   - `csv_col`: column in the CSV with the data
#   - `init`: initial value of slider
plot_hide_stats_default: &plot_hide_stats_default
  functional effect:
    csv: results/func_effects/averages/293T_entry_func_effects.csv
    csv_col: effect
    init: -3
    min_filters:
      times_seen: 2

# define the antibody selections
antibody_selections:
  # --------------------------------------------------------------------------------------
  Lib1-230613-sera-1-05:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230613-no-antibody-control
    antibody_samples:
     Lib1-230613-sera-1-05-0.000445:
      concentration: 0.000445
      use_in_fit: true
     Lib1-230613-sera-1-05-0.00178:
      concentration: 0.00178
      use_in_fit: true
     Lib1-230613-sera-1-05-0.00712:
      concentration: 0.00712
      use_in_fit: true

  Lib2-230613-sera-1-05:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230613-no-antibody-control
    antibody_samples:
     Lib2-230613-sera-1-05-0.000445:
      concentration: 0.000445
      use_in_fit: true
     Lib2-230613-sera-1-05-0.00178:
      concentration: 0.00178
      use_in_fit: true
     Lib2-230613-sera-1-05-0.00712:
      concentration: 0.00712
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-230630-sera-1-01:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230630-no-antibody-control
    antibody_samples:
     Lib1-230630-sera-1-01-0.00088:
      concentration: 0.00088
      use_in_fit: true
     Lib1-230630-sera-1-01-0.0035:
      concentration: 0.0035
      use_in_fit: true
     Lib1-230630-sera-1-01-0.014:
      concentration: 0.014
      use_in_fit: true

  Lib2-230630-sera-1-01:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230630-no-antibody-control
    antibody_samples:
     Lib2-230630-sera-1-01-0.00088:
      concentration: 0.00088
      use_in_fit: true
     Lib2-230630-sera-1-01-0.0035:
      concentration: 0.0035
      use_in_fit: true
     Lib2-230630-sera-1-01-0.014:
      concentration: 0.014
      use_in_fit: true

  Lib1-230724-sera-1-01:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230724-no-antibody-control
    antibody_samples:
     Lib1-230724-sera-1-01-0.004:
      concentration: 0.004
      use_in_fit: true
     Lib1-230724-sera-1-01-0.016:
      concentration: 0.016
      use_in_fit: true
     Lib1-230724-sera-1-01-0.064:
      concentration: 0.064
      use_in_fit: true

  Lib2-230724-sera-1-01:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230724-no-antibody-control
    antibody_samples:
     Lib2-230724-sera-1-01-0.004:
      concentration: 0.004
      use_in_fit: true
     Lib2-230724-sera-1-01-0.016:
      concentration: 0.016
      use_in_fit: false
     Lib2-230724-sera-1-01-0.064:
      concentration: 0.064
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-230630-sera-1-02:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230630-no-antibody-control
    antibody_samples:
     Lib1-230630-sera-1-02-0.00136:
      concentration: 0.00136
      use_in_fit: true
     Lib1-230630-sera-1-02-0.00544:
      concentration: 0.00544
      use_in_fit: true
     Lib1-230630-sera-1-02-0.02176:
      concentration: 0.02176
      use_in_fit: true

  Lib2-230630-sera-1-02:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230630-no-antibody-control
    antibody_samples:
     Lib2-230630-sera-1-02-0.00136:
      concentration: 0.00136
      use_in_fit: true
     Lib2-230630-sera-1-02-0.00544:
      concentration: 0.00544
      use_in_fit: true
     Lib2-230630-sera-1-02-0.02176:
      concentration: 0.02176
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-230630-sera-1-03:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230630-no-antibody-control
    antibody_samples:
     Lib1-230630-sera-1-03-0.00515:
      concentration: 0.00515
      use_in_fit: true
     Lib1-230630-sera-1-03-0.0206:
      concentration: 0.0206
      use_in_fit: true
     Lib1-230630-sera-1-03-0.08242:
      concentration: 0.08242
      use_in_fit: true

  Lib2-230630-sera-1-03:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230630-no-antibody-control
    antibody_samples:
     Lib2-230630-sera-1-03-0.00515:
      concentration: 0.00515
      use_in_fit: true
     Lib2-230630-sera-1-03-0.0206:
      concentration: 0.0206
      use_in_fit: true
     Lib2-230630-sera-1-03-0.08242:
      concentration: 0.08242
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-230630-sera-1-04:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230630-no-antibody-control
    antibody_samples:
     Lib1-230630-sera-1-04-0.00838:
      concentration: 0.00838
      use_in_fit: true
     Lib1-230630-sera-1-04-0.0335:
      concentration: 0.0335
      use_in_fit: true
     Lib1-230630-sera-1-04-0.13402:
      concentration: 0.13402
      use_in_fit: true

  Lib2-230630-sera-1-04:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230630-no-antibody-control
    antibody_samples:
     Lib2-230630-sera-1-04-0.00838:
      concentration: 0.00838
      use_in_fit: true
     Lib2-230630-sera-1-04-0.0335:
      concentration: 0.0335
      use_in_fit: true
     Lib2-230630-sera-1-04-0.13402:
      concentration: 0.13402
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-230630-sera-2-04:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230630-no-antibody-control
    antibody_samples:
     Lib1-230630-sera-2-04-0.00681:
      concentration: 0.00838
      use_in_fit: true
     Lib1-230630-sera-2-04-0.02724:
      concentration: 0.0335
      use_in_fit: true
     Lib1-230630-sera-2-04-0.10898:
      concentration: 0.13402
      use_in_fit: true

  Lib2-230630-sera-2-04:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230630-no-antibody-control
    antibody_samples:
     Lib2-230630-sera-2-04-0.00681:
      concentration: 0.00838
      use_in_fit: true
     Lib2-230630-sera-2-04-0.02724:
      concentration: 0.0335
      use_in_fit: true
     Lib2-230630-sera-2-04-0.10898:
      concentration: 0.13402
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-230724-sera-2-01:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230724-no-antibody-control
    antibody_samples:
     Lib1-230724-sera-2-01-0.01138:
      concentration: 0.01138
      use_in_fit: true
     Lib1-230724-sera-2-01-0.04552:
      concentration: 0.04552
      use_in_fit: true
     Lib1-230724-sera-2-01-0.17555:
      concentration: 0.17555
      use_in_fit: true

  Lib2-230724-sera-2-01:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230724-no-antibody-control
    antibody_samples:
     Lib2-230724-sera-2-01-0.01138:
      concentration: 0.01138
      use_in_fit: true
     Lib2-230724-sera-2-01-0.04552:
      concentration: 0.04552
      use_in_fit: true
     Lib2-230724-sera-2-01-0.17555:
      concentration: 0.17555
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-230724-sera-2-05:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230724-no-antibody-control
    antibody_samples:
     Lib1-230724-sera-2-05-0.01488:
      concentration: 0.01488
      use_in_fit: true
     Lib1-230724-sera-2-05-0.05953:
      concentration: 0.05953
      use_in_fit: true
     Lib1-230724-sera-2-05-0.21781:
      concentration: 0.21781
      use_in_fit: true

  Lib2-230724-sera-2-05:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230724-no-antibody-control
    antibody_samples:
     Lib2-230724-sera-2-05-0.01488:
      concentration: 0.01488
      use_in_fit: true
     Lib2-230724-sera-2-05-0.05953:
      concentration: 0.05953
      use_in_fit: true
     Lib2-230724-sera-2-05-0.21781:
      concentration: 0.21781
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-230822-ferret-sera-7:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230822-no-antibody-control
    antibody_samples:
     Lib1-230822-ferret-sera-7-0.00184:
      concentration: 0.00184
      use_in_fit: true
     Lib1-230822-ferret-sera-7-0.00736:
      concentration: 0.00736
      use_in_fit: true
     Lib1-230822-ferret-sera-7-0.02944:
      concentration: 0.02944
      use_in_fit: true

  Lib2-230822-ferret-sera-7:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230822-no-antibody-control
    antibody_samples:
     Lib2-230822-ferret-sera-7-0.00184:
      concentration: 0.00184
      use_in_fit: true
     Lib2-230822-ferret-sera-7-0.00736:
      concentration: 0.00736
      use_in_fit: true
     Lib2-230822-ferret-sera-7-0.02944:
      concentration: 0.02944
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-230822-ferret-sera-10:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230822-no-antibody-control
    antibody_samples:
     Lib1-230822-ferret-sera-10-0.00178:
      concentration: 0.00178
      use_in_fit: true
     Lib1-230822-ferret-sera-10-0.00491:
      concentration: 0.00491
      use_in_fit: true
     Lib1-230822-ferret-sera-10-0.01965:
      concentration: 0.01965
      use_in_fit: true

  Lib2-230822-ferret-sera-10:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230822-no-antibody-control
    antibody_samples:
     Lib2-230822-ferret-sera-10-0.00178:
      concentration: 0.00178
      use_in_fit: true
     Lib2-230822-ferret-sera-10-0.00491:
      concentration: 0.00491
      use_in_fit: true
     Lib2-230822-ferret-sera-10-0.01965:
      concentration: 0.01965
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-230822-ferret-sera-19:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230822-no-antibody-control
    antibody_samples:
     Lib1-230822-ferret-sera-19-0.00178:
      concentration: 0.00178
      use_in_fit: true
     Lib1-230822-ferret-sera-19-0.00378:
      concentration: 0.00378
      use_in_fit: true
     Lib1-230822-ferret-sera-19-0.0151:
      concentration: 0.0151
      use_in_fit: true

  Lib2-230822-ferret-sera-19:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230822-no-antibody-control
    antibody_samples:
     Lib2-230822-ferret-sera-19-0.00178:
      concentration: 0.00178
      use_in_fit: true
     Lib2-230822-ferret-sera-19-0.00378:
      concentration: 0.00378
      use_in_fit: true
     Lib2-230822-ferret-sera-19-0.0151:
      concentration: 0.0151
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-231129-pig-sera-972:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-231129-no-antibody-control
    antibody_samples:
     Lib1-231129-pig-sera-972-0.00708:
      concentration: 0.00708
      use_in_fit: true
     Lib1-231129-pig-sera-972-0.0283:
      concentration: 0.0283
      use_in_fit: true
     Lib1-231129-pig-sera-972-0.11321:
      concentration: 0.11321
      use_in_fit: true

  Lib2-231129-pig-sera-972:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-231129-no-antibody-control
    antibody_samples:
     Lib2-231129-pig-sera-972-0.00552:
      concentration: 0.00552
      use_in_fit: true
     Lib2-231129-pig-sera-972-0.01934:
      concentration: 0.01934
      use_in_fit: true
     Lib2-231129-pig-sera-972-0.0663:
      concentration: 0.0663
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-231129-pig-sera-973:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-231129-no-antibody-control
    antibody_samples:
     Lib1-231129-pig-sera-973-0.00566:
      concentration: 0.00566
      use_in_fit: true
     Lib1-231129-pig-sera-973-0.02264:
      concentration: 0.02264
      use_in_fit: true
     Lib1-231129-pig-sera-973-0.08962:
      concentration: 0.08962
      use_in_fit: true

  Lib2-231129-pig-sera-973:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-231129-no-antibody-control
    antibody_samples:
     Lib2-231129-pig-sera-973-0.00552:
      concentration: 0.00552
      use_in_fit: true
     Lib2-231129-pig-sera-973-0.01934:
      concentration: 0.01934
      use_in_fit: true
     Lib2-231129-pig-sera-973-0.05525:
      concentration: 0.05525
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-231129-pig-sera-977:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-231129-no-antibody-control
    antibody_samples:
     Lib1-231129-pig-sera-977-0.00505:
      concentration: 0.00505
      use_in_fit: true
     Lib1-231129-pig-sera-977-0.02028:
      concentration: 0.02028
      use_in_fit: true
     Lib1-231129-pig-sera-977-0.08113:
      concentration: 0.08113
      use_in_fit: true

  Lib2-231129-pig-sera-977:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-231129-no-antibody-control
    antibody_samples:
     Lib2-231129-pig-sera-977-0.00552:
      concentration: 0.00552
      use_in_fit: true
     Lib2-231129-pig-sera-977-0.01934:
      concentration: 0.01934
      use_in_fit: true
     Lib2-231129-pig-sera-977-0.05525:
      concentration: 0.05525
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-231129-pig-sera-978:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-231129-no-antibody-control
    antibody_samples:
     Lib1-231129-pig-sera-978-0.00943:
      concentration: 0.00943
      use_in_fit: true
     Lib1-231129-pig-sera-978-0.02358:
      concentration: 0.02358
      use_in_fit: true
     Lib1-231129-pig-sera-978-0.09434:
      concentration: 0.09434
      use_in_fit: true

  Lib2-231129-pig-sera-978:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-231129-no-antibody-control
    antibody_samples:
     Lib2-231129-pig-sera-978-0.00552:
      concentration: 0.00552
      use_in_fit: true
     Lib2-231129-pig-sera-978-0.01934:
      concentration: 0.01934
      use_in_fit: true
     Lib2-231129-pig-sera-978-0.05525:
      concentration: 0.05525
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-241216-mAb26:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-241216-no-antibody-control
    antibody_samples:
     Lib1-241216-mAb26_2.1:
      concentration: 2.1
      use_in_fit: true
     Lib1-241216-mAb26_8.4:
      concentration: 8.4
      use_in_fit: true

  Lib2-241216-mAb26:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-241216-no-antibody-control
    antibody_samples:
     Lib2-241216-mAb26_2.1:
      concentration: 2.1
      use_in_fit: true
     Lib2-241216-mAb26_8.4:
      concentration: 8.4
      use_in_fit: true

# --------------------------------------------------------------------------------------

  Lib1-241216-mAb74:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-241216-no-antibody-control
    antibody_samples:
     Lib1-241216-mAb74_2.84:
      concentration: 2.84
      use_in_fit: true
     Lib1-241216-mAb74_11.38:
      concentration: 11.28
      use_in_fit: true

  Lib2-241216-mAb74:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-241216-no-antibody-control
    antibody_samples:
     Lib2-241216-mAb74_2.84:
      concentration: 2.84
      use_in_fit: true
     Lib2-241216-mAb74_11.38:
      concentration: 11.28
      use_in_fit: true

# --------------------------------------------------------------------------------------

  Lib1-241216-mAb7011:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-241216-no-antibody-control
    antibody_samples:
     Lib1-241216-mAb7011_16.8:
      concentration: 16.8
      use_in_fit: true
     Lib1-241216-mAb7011_67.2:
      concentration: 67.2
      use_in_fit: true

  Lib2-241216-mAb7011:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-241216-no-antibody-control
    antibody_samples:
     Lib2-241216-mAb7011_16.8:
      concentration: 16.8
      use_in_fit: true
     Lib2-241216-mAb7011_67.2:
      concentration: 67.2
      use_in_fit: true

# --------------------------------------------------------------------------------------

  Lib1-241216-mAb12D03:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-241216-no-antibody-control
    antibody_samples:
     Lib1-241216-mAb12D03_1.29:
      concentration: 1.29
      use_in_fit: true
     Lib1-241216-mAb12D03_5.16:
      concentration: 5.16
      use_in_fit: true

  Lib2-241216-mAb12D03:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-241216-no-antibody-control
    antibody_samples:
     Lib2-241216-mAb12D03_1.29:
      concentration: 1.29
      use_in_fit: true
     Lib2-241216-mAb12D03_5.16:
      concentration: 5.16
      use_in_fit: true

# --------------------------------------------------------------------------------------

  Lib1-241216-mAb1H02:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-241216-no-antibody-control
    antibody_samples:
     Lib1-241216-mAb1H02_2.76:
      concentration: 2.76
      use_in_fit: true
     Lib1-241216-mAb1H02_11.04:
      concentration: 11.04
      use_in_fit: true


  Lib2-241216-mAb1H02:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-241216-no-antibody-control
    antibody_samples:
     Lib2-241216-mAb1H02_2.76:
      concentration: 2.76
      use_in_fit: true
     Lib2-241216-mAb1H02_11.04:
      concentration: 11.04
      use_in_fit: true


# define the stability selections
stability_selections:
  # --------------------------------------------------------------------------------------
  Lib1-230822-pH:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib1-230822-pH-D10
    antibody_samples:
     Lib1-230822-pH-5.5:
      concentration: 1.9
      use_in_fit: true

  Lib2-230822-pH:
    neut_standard_name: neut_standard
    prob_escape_filters: *prob_escape_filters_default
    polyclonal_params: *polyclonal_params_default
    escape_plot_kwargs: *escape_plot_kwargs_default
    plot_hide_stats: *plot_hide_stats_default
    no_antibody_sample: Lib2-230822-pH-D10
    antibody_samples:
     Lib2-230822-pH-5.5:
      concentration: 1.9
      use_in_fit: true

  # --------------------------------------------------------------------------------------
  Lib1-231002-pH:
     neut_standard_name: neut_standard
     prob_escape_filters: *prob_escape_filters_default
     polyclonal_params: *polyclonal_params_default
     escape_plot_kwargs: *escape_plot_kwargs_default
     plot_hide_stats: *plot_hide_stats_default
     no_antibody_sample: Lib1-231002-pH-D10
     antibody_samples:
      Lib1-231002-pH-5.3:
        concentration: 2.1
        use_in_fit: true
      Lib1-231002-pH-5.5:
        concentration: 1.9
        use_in_fit: true
      Lib1-231002-pH-5.7:
        concentration: 1.7
        use_in_fit: true

  Lib2-231002-pH:
     neut_standard_name: neut_standard
     prob_escape_filters: *prob_escape_filters_default
     polyclonal_params: *polyclonal_params_default
     escape_plot_kwargs: *escape_plot_kwargs_default
     plot_hide_stats: *plot_hide_stats_default
     no_antibody_sample: Lib2-231002-pH-D10
     antibody_samples:
      Lib2-231002-pH-5.3:
       concentration: 2.1
       use_in_fit: true
      Lib2-231002-pH-5.5:
       concentration: 1.9
       use_in_fit: true
      Lib2-231002-pH-5.7:
       concentration: 1.7
       use_in_fit: true

# --------------------------------------------------------------------------------------
# Configuration for averaging and plotting selections for an assay
# --------------------------------------------------------------------------------------

# Average/plot escape values from different selections for an assay using `<assay>_ecape`.
# Each key is the name of an antibody/serum that has the following values:
#   - `selections`: list of antibody selections for which we average escape
#   - `icXX`: for the plot showing fold-change in ICXX (eg, IC90), what is XX (eg, 90)
#   - `escape_plot_kwargs`: keyword arguments for `PolyclonalAverage.mut_escape_plot`
#   - `plot_hide_stats`: dict giving data frames with stats for slider to hide mutations

# Define defaults for each antibody/serum, used via the merge (<<) operator
avg_antibody_escape_default: &avg_antibody_escape_default
  icXX: 80
  escape_plot_kwargs:
    <<: *escape_plot_kwargs_default
    addtl_slider_stats:
      times_seen: 2
      nt changes to codon: 3
    addtl_slider_stats_as_max: [nt changes to codon]
    addtl_slider_stats_hide_not_filter: [nt changes to codon]
    slider_binding_range_kwargs:
      nt changes to codon:
        min: 1
        max: 3
        step: 1
      times_seen:
        min: 1
        max: 10
        step: 1
    avg_type: median
    per_model_tooltip: true
  plot_hide_stats: *plot_hide_stats_default

# Define the antibodies/sera to average
avg_antibody_escape:
  mouse-1-01:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230630-sera-1-01
      - Lib2-230630-sera-1-01
      - Lib1-230724-sera-1-01
      - Lib2-230724-sera-1-01
  mouse-1-02:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230630-sera-1-02
      - Lib2-230630-sera-1-02
  mouse-1-03:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230630-sera-1-03
      - Lib2-230630-sera-1-03
  mouse-1-04:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230630-sera-1-04
      - Lib2-230630-sera-1-04
  mouse-1-05:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230613-sera-1-05
      - Lib2-230613-sera-1-05
  mouse-2-01:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230724-sera-2-01
      - Lib2-230724-sera-2-01
  mouse-2-04:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230630-sera-2-04
      - Lib2-230630-sera-2-04
  mouse-2-05:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230724-sera-2-05
      - Lib2-230724-sera-2-05

  ferret-7:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230822-ferret-sera-7
      - Lib2-230822-ferret-sera-7
  ferret-10:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230822-ferret-sera-10
      - Lib2-230822-ferret-sera-10
  ferret-19:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-230822-ferret-sera-19
      - Lib2-230822-ferret-sera-19

  pig-972:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-231129-pig-sera-972
      - Lib2-231129-pig-sera-972
  pig-973:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-231129-pig-sera-973
      - Lib2-231129-pig-sera-973
  pig-977:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-231129-pig-sera-977
      - Lib2-231129-pig-sera-977
  pig-978:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-231129-pig-sera-978
      - Lib2-231129-pig-sera-978
  326-366-26:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-241216-mAb26
      - Lib2-241216-mAb26
  326-289-74:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-241216-mAb74
      - Lib2-241216-mAb74
  310-7D11:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-241216-mAb7011
      - Lib2-241216-mAb7011
  310-12D03:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-241216-mAb12D03
      - Lib2-241216-mAb12D03
  310-1H02:
    <<: *avg_antibody_escape_default
    selections:
      - Lib1-241216-mAb1H02
      - Lib2-241216-mAb1H02

# define the pH stability selections to average
avg_stability:
  stability:
    icXX: 80
    escape_plot_kwargs:
      <<: *escape_plot_kwargs_default
      init_site_statistic: mean
      init_floor_at_zero: true
      addtl_slider_stats:
        times_seen: 2
        nt changes to codon: 3
      addtl_slider_stats_as_max: [nt changes to codon]
      addtl_slider_stats_hide_not_filter: [nt changes to codon]
      slider_binding_range_kwargs:
        nt changes to codon:
          min: 1
          max: 3
          step: 1
        times_seen:
          min: 1
          max: 10
          step: 1
      avg_type: median
      per_model_tooltip: true
    plot_hide_stats: *plot_hide_stats_default
    selections:
      - Lib1-230822-pH
      - Lib2-230822-pH
      - Lib1-231002-pH
      - Lib2-231002-pH
